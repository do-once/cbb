{"version":3,"file":"DoonceHtmlParser.js","sourceRoot":"","sources":["../src/DoonceHtmlParser.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @author GuangHui\n * @description DoonceHtmlParser 主体程序\n */\n\n/** <         div       id=\"app\"      >           hello   <           /                   div             >           */\n/** TAG_OPEN  TAG_NAME  TAG_ATTR_TEXT TAG_CLOSE   TEXT    TAG_OPEN    TAG_SELF_CLOSEING   POST_TAG_NAME   TAG_CLOSE   */\n\nexport enum StateEnum {\n  START = 'START' /** 初始状态 */,\n  TAG_OPEN = 'TAG_OPEN' /** 标签开头< */,\n  TAG_NAME = 'TAG_NAME' /** 标签名 */,\n  TAG_ATTR_TEXT = 'TAG_ATTR_TEXT' /** 属性文本 */,\n  TAG_SELF_CLOSEING = 'TAG_SELF_CLOSEING' /** 结束标签中的/ */,\n  POST_TAG_NAME = 'POST_TAG_NAME' /** 结束标签名 */,\n  TAG_CLOSE = 'TAG_CLOSE' /** 标签结尾> */,\n  TEXT = 'TEXT' /** 标签内容 */,\n  COMMENT = 'COMMENT' /** 注释信息 */\n}\n\nexport type Token = {\n  type: StateEnum\n  startIndex: number /** 相对输入字符串的开始索引位置 */\n  content: string /** 内容 */\n}\n\nexport type AstNode = {\n  nodeType: 'ELEMENT' | 'COMMENT' | 'TEXT' | 'ROOT'\n  nodeName: string\n  content: string\n  attrText: string\n  attrObj: Record<string, unknown>\n  children: AstNode[]\n}\n\nexport class DoonceHtmlParser {\n  static State = StateEnum\n\n  debug: boolean\n\n  constructor({ debug } = {} as { debug?: boolean }) {\n    this.debug = !!debug\n  }\n\n  /**\n   * 解析输入的 html 字符串,返回 tokenList\n   *\n   * @date 2023-07-25 19:46:40\n   * @param input 输入字符串\n   * @returns {Token[]} tokenList\n   * @memberof DoonceHtmlParser\n   */\n  parse(input: string): Token[] {\n    if (!input || typeof input !== 'string') throw new Error('Input string is need provided')\n\n    const tokenList: Token[] = []\n    let curState: StateEnum = StateEnum.START\n    let curChar = ''\n    let curCharIndex = 0\n\n    while ((curChar = input[curCharIndex])) {\n      this.debug && console.log('-------------------------')\n      this.debug && console.log('before :>> ', curState, curCharIndex, curChar)\n\n      switch (curState) {\n        case StateEnum.START:\n          if (curChar === '<') {\n            curState = StateEnum.TAG_OPEN\n          } else {\n            curState = StateEnum.TEXT\n\n            /** 初始化 text Token,开始收集 text */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          }\n          break\n\n        case StateEnum.TAG_OPEN:\n          if (isLetter(curChar)) {\n            curState = StateEnum.TAG_NAME\n\n            /** 初始化 tagName Token,开始收集 tagName */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          } else if (curChar === '/') {\n            curState = StateEnum.TAG_SELF_CLOSEING\n          } else if (curChar === '!') {\n            curState = StateEnum.COMMENT\n\n            /** 初始化 comment Token,开始收集 comment */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          } else {\n            //! should never access\n            this.debug && console.warn(`Unrecognized char:${curChar} on StateEnum.${curState}`)\n          }\n          break\n\n        case StateEnum.TAG_NAME:\n          if (curChar === '>') {\n            curState = StateEnum.TAG_CLOSE\n          } else if (isWhiteSpace(curChar) && input[curCharIndex + 1] !== '/') {\n            curState = StateEnum.TAG_ATTR_TEXT\n\n            /** 初始化 tagAttrText Token,开始收集 tagAttrText */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          } else if (\n            /** 兼容类似<br/>情况 */\n            curChar === '/' ||\n            /** 兼容类似<br />情况 */\n            (isWhiteSpace(curChar) && input[curCharIndex + 1] === '/')\n          ) {\n            curState = StateEnum.TAG_SELF_CLOSEING\n          } else {\n            /** 收集 tagName */\n            tokenList[tokenList.length - 1].content += curChar\n          }\n          break\n\n        case StateEnum.TAG_ATTR_TEXT:\n          if (curChar === '>') {\n            curState = StateEnum.TAG_CLOSE\n          } else if (\n            /** 当前为/后面为>或空格*/\n            curChar === '/' &&\n            (input[curCharIndex + 1] === '>' || isWhiteSpace(input[curCharIndex + 1]))\n          ) {\n            curState = StateEnum.TAG_SELF_CLOSEING\n          } else {\n            /** 收集 tagAttrText */\n            tokenList[tokenList.length - 1].content += curChar\n          }\n          break\n\n        case StateEnum.TAG_SELF_CLOSEING:\n          if (curChar === '>') {\n            curState = StateEnum.TAG_CLOSE\n\n            /** 兼容自闭合标签场景,添加一个与最后 tagName 对应的selfCloseing 对象 */\n            const lastMatchedTagNameObj = this._findLastMatchedTagNameObj(tokenList)\n            if (lastMatchedTagNameObj && lastMatchedTagNameObj.content) {\n              tokenList.push({\n                type: StateEnum.TAG_SELF_CLOSEING,\n                content: lastMatchedTagNameObj.content,\n                startIndex: curCharIndex\n              })\n            }\n          } else if (isLetter(curChar)) {\n            curState = StateEnum.POST_TAG_NAME\n\n            /** 初始化 postTagName Token,开始收集 postTagName */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          } else {\n            //! should never access\n            this.debug && console.warn(`Unrecognized char:${curChar} on StateEnum.${curState}`)\n          }\n          break\n\n        case StateEnum.POST_TAG_NAME:\n          if (curChar === '>') {\n            curState = StateEnum.TAG_CLOSE\n          } else {\n            /** 收集postTagName */\n            tokenList[tokenList.length - 1].content += curChar\n          }\n          break\n\n        case StateEnum.TAG_CLOSE:\n          if (curChar === '<') {\n            curState = StateEnum.TAG_OPEN\n          } else if (curChar) {\n            curState = StateEnum.TEXT\n\n            /** 初始化 text Token,开始收集 text */\n            tokenList.push({\n              type: curState,\n              startIndex: curCharIndex,\n              content: curChar\n            })\n          } else {\n            //! should never access\n            this.debug && console.warn(`Unrecognized char:${curChar} on StateEnum.${curState}`)\n          }\n          break\n\n        case StateEnum.COMMENT:\n          if (curChar === '>') {\n            curState = StateEnum.TAG_CLOSE\n          } else {\n            /** 收集 comment */\n            tokenList[tokenList.length - 1].content += curChar\n          }\n          break\n\n        case StateEnum.TEXT:\n          if (\n            /** 当前为< && 后续字符中有 > && <到首个>之间无其它<,则进入 TAG_OPEN 状态 */\n            curChar === '<' &&\n            this._hasLessThanSymbolBetweenStartIndexAndFirstGreatThanSymbolIndex(input, curCharIndex)\n          ) {\n            curState = StateEnum.TAG_OPEN\n          } else {\n            /** 收集 text */\n            tokenList[tokenList.length - 1].content += curChar\n          }\n          break\n\n        default:\n          const _ec: never = curState\n          throw new Error(`${_ec} should not reach here`)\n      }\n\n      this.debug && console.log('after :>> ', curState)\n\n      curCharIndex++\n    }\n\n    this.debug && console.log('parse before input :>> ', input)\n    this.debug && console.log('parse after tokenList :>> ', tokenList)\n\n    return tokenList\n  }\n\n  /**\n   * 将 tokenList 解析为 ast\n   *\n   * @date 2023-07-25 19:45:49\n   * @private\n   * @param tokenList\n   * @returns {AstNode} ast对象\n   * @memberof DoonceHtmlParser\n   */\n  parseTokenListToAst(tokenList: Token[]) {\n    const nodeStack: AstNode[] = [\n      {\n        nodeType: 'ROOT',\n        nodeName: '',\n        content: '',\n        attrText: '',\n        attrObj: {},\n        children: []\n      }\n    ]\n\n    for (let i = 0; i < tokenList.length; i++) {\n      const { type, content } = tokenList[i]\n\n      if (type === StateEnum.TAG_NAME) {\n        nodeStack.push({\n          nodeType: 'ELEMENT',\n          nodeName: content,\n          content: '',\n          attrText: '',\n          attrObj: {},\n          children: []\n        })\n      } else if (type === StateEnum.TEXT) {\n        nodeStack[nodeStack.length - 1].children.push({\n          nodeType: 'TEXT',\n          nodeName: '',\n          content,\n          attrText: '',\n          attrObj: {},\n          children: []\n        })\n      } else if (type === StateEnum.TAG_ATTR_TEXT) {\n        const node = nodeStack[nodeStack.length - 1]\n        node.attrText = content\n\n        node.attrObj = parseAttrTextToObj(content)\n      } else if (type === StateEnum.COMMENT) {\n        nodeStack[nodeStack.length - 1].children.push({\n          nodeType: 'COMMENT',\n          nodeName: '',\n          content,\n          attrText: '',\n          attrObj: {},\n          children: []\n        })\n      } else if (type === StateEnum.POST_TAG_NAME || type === StateEnum.TAG_SELF_CLOSEING) {\n        if (content === nodeStack[nodeStack.length - 1].nodeName) {\n          const obj = nodeStack.pop()\n\n          obj && nodeStack[nodeStack.length - 1].children.push(obj)\n        }\n      } else {\n        // ! should never access\n        this.debug && console.warn('should never access')\n      }\n    }\n\n    this.debug && console.log('nodeStack :>> ', JSON.stringify(nodeStack, null, 2))\n\n    return nodeStack[0]\n  }\n\n  /**\n   * 找到 tokenList 中最后一个 TAG_NAME 对象\n   *\n   * @date 2023-07-25 19:40:18\n   * @private\n   * @param tokenList\n   * @returns {Token} TAG_NAME 对象\n   * @memberof DoonceHtmlParser\n   */\n  private _findLastMatchedTagNameObj(tokenList: Token[]) {\n    return tokenList\n      .slice()\n      .reverse()\n      .find(token => token.type === StateEnum.TAG_NAME)\n  }\n\n  /**\n   * 给定字符串,从给定位置到首个>符号之前,是否存在<符号\n   *\n   * @date 2023-07-09 01:22:43\n   * @private\n   * @param input 输入字符串\n   * @param startIndex <字符起始索引\n   * @returns {boolean} 是否从 TEXT 转换为 TAG_OPEN 状态\n   * @memberof DoonceHtmlParser\n   */\n  private _hasLessThanSymbolBetweenStartIndexAndFirstGreatThanSymbolIndex(input: string, startIndex: number) {\n    const afterStartIndexStr = input.slice(startIndex + 1)\n    const firstGreatThanSymbolIndex = afterStartIndexStr.indexOf('>')\n\n    if (firstGreatThanSymbolIndex === -1) return false\n\n    return afterStartIndexStr.slice(0, firstGreatThanSymbolIndex).indexOf('<') === -1\n  }\n}\n\n/**\n * 将 attrText 解析为对象\n *\n * @date 2023-07-26 10:08:25\n * @export\n * @param attrText\n * @returns {Record<string,string>}\n */\nexport function parseAttrTextToObj(attrText: string): Record<string, string> {\n  if (typeof attrText !== 'string') return {}\n\n  const attributeRegex = /(\\S+)=[\"']?([^\"'\\s]+(?:\\s+[^\"'\\s]+)*)[\"']?/g\n  const attributes: Record<string, string> = {}\n\n  let match\n  while ((match = attributeRegex.exec(attrText)) !== null) {\n    const attributeName = match[1]\n    const attributeValue = match[2]\n\n    attributes[attributeName] = attributeValue\n  }\n\n  return attributes\n}\n\n/**\n * 提取 htmlComment 中的内容\n *\n * @date 2023-07-09 04:30:03\n * @export\n * @param htmlComment html 注释\n * @returns {string} 内容\n */\nexport function extractHtmlCommentContent(htmlComment: string) {\n  const reg = /!--(.+?)--/\n\n  if (!reg.test(htmlComment)) return htmlComment\n\n  return htmlComment.match(reg)![1]\n}\n\n/**\n * 是否英文字母\n *\n * @date 2023-07-09 01:19:52\n * @export\n * @param char\n * @returns {boolean} 是否英文字母\n */\nexport function isLetter(char: string) {\n  return /^[a-zA-Z]$/.test(char)\n}\n\n/**\n * 是否空白字符\n *\n * @date 2023-07-09 01:19:23\n * @export\n * @param char\n * @returns {boolean} 是否空白字符\n */\nexport function isWhiteSpace(char: string) {\n  return /^\\s+$/.test(char)\n}\n"]}